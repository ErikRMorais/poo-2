{% extends "base.html" %}

{% block title %}{{ produto.nome }} - SCEE{% endblock %}

{% block content %}
<div class="produto-detalhe">
    <div class="produto-imagens">
        {% if produto.imagens %}
        <!-- Carrossel de Imagens -->
        <div class="carrossel-container">
            <div class="carrossel-principal">
                {% for imagem in produto.imagens %}
                <div class="carrossel-slide {% if loop.first %}active{% endif %}" data-slide="{{ loop.index0 }}">
                    <img src="{{ url_for('static', filename=imagem.caminho) }}" alt="{{ produto.nome }}">
                </div>
                {% endfor %}
                
                <!-- Bot√µes de Navega√ß√£o -->
                {% if produto.imagens|length > 1 %}
                <button class="carrossel-btn prev" onclick="mudarSlide(-1)">‚ùÆ</button>
                <button class="carrossel-btn next" onclick="mudarSlide(1)">‚ùØ</button>
                {% endif %}
            </div>
            
            <!-- Miniaturas -->
            {% if produto.imagens|length > 1 %}
            <div class="carrossel-miniaturas">
                {% for imagem in produto.imagens %}
                <div class="miniatura {% if loop.first %}active{% endif %}" onclick="irParaSlide({{ loop.index0 }})">
                    <img src="{{ url_for('static', filename=imagem.caminho) }}" alt="{{ produto.nome }}">
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Indicadores -->
            {% if produto.imagens|length > 1 %}
            <div class="carrossel-indicadores">
                {% for imagem in produto.imagens %}
                <span class="indicador {% if loop.first %}active{% endif %}" onclick="irParaSlide({{ loop.index0 }})"></span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% else %}
            <div class="produto-sem-imagem-grande">Sem imagem</div>
        {% endif %}
    </div>
    
    <div class="produto-info">
        <h1>{{ produto.nome }}</h1>
        <p class="categoria">Categoria: {{ produto.categoria.nome }}</p>
        <p class="sku">SKU: {{ produto.sku }}</p>
        <p class="preco-grande">R$ {{ "%.2f"|format(produto.preco) }}</p>
        
        {% if produto.estoque > 0 %}
            <p class="estoque-disponivel">‚úì Em estoque: {{ produto.estoque }} unidades dispon√≠veis</p>
        {% else %}
            <div class="alerta-sem-estoque">
                <p class="sem-estoque">‚úó PRODUTO SEM ESTOQUE</p>
                <p class="aviso-estoque">Este produto est√° temporariamente indispon√≠vel.</p>
            </div>
        {% endif %}
        
        <div class="descricao">
            <h2>Descri√ß√£o</h2>
            <p>{{ produto.descricao }}</p>
        </div>
        
        {% if produto.estoque > 0 %}
        <form method="POST" action="{{ url_for('adicionar_carrinho', produto_id=produto.id) }}" class="form-adicionar">
            <div class="form-group">
                <label for="quantidade">Quantidade:</label>
                <input type="number" id="quantidade" name="quantidade" value="1" min="1" max="{{ produto.estoque }}" required>
            </div>
            <button type="submit" class="btn btn-primary">üõí Adicionar ao Carrinho</button>
        </form>
        {% else %}
        <button class="btn btn-disabled" disabled>üõí Indispon√≠vel para Compra</button>
        <p class="texto-indisponivel">Entre em contato para saber quando este produto estar√° dispon√≠vel.</p>
        {% endif %}
    </div>
</div>

{% if produto.imagens and produto.imagens|length > 1 %}
<script>
let slideAtual = 0;
const totalSlides = {{ produto.imagens|length }};

function mostrarSlide(n) {
    const slides = document.querySelectorAll('.carrossel-slide');
    const miniaturas = document.querySelectorAll('.miniatura');
    const indicadores = document.querySelectorAll('.indicador');
    
    // Ajustar √≠ndice
    if (n >= totalSlides) {
        slideAtual = 0;
    } else if (n < 0) {
        slideAtual = totalSlides - 1;
    } else {
        slideAtual = n;
    }
    
    // Remover classe active de todos
    slides.forEach(slide => slide.classList.remove('active'));
    miniaturas.forEach(mini => mini.classList.remove('active'));
    indicadores.forEach(ind => ind.classList.remove('active'));
    
    // Adicionar classe active ao slide atual
    slides[slideAtual].classList.add('active');
    miniaturas[slideAtual].classList.add('active');
    indicadores[slideAtual].classList.add('active');
}

function mudarSlide(direcao) {
    mostrarSlide(slideAtual + direcao);
}

function irParaSlide(n) {
    mostrarSlide(n);
}

// Navega√ß√£o por teclado
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
        mudarSlide(-1);
    } else if (e.key === 'ArrowRight') {
        mudarSlide(1);
    }
});

// Auto-play (opcional - descomente para ativar)
// setInterval(() => mudarSlide(1), 5000);
</script>
{% endif %}
{% endblock %}
